FROM kong:3.9

USER root

# Tạo thư mục plugin
RUN mkdir -p /usr/local/share/lua/5.1/kong/plugins/keycloak-introspect

# Copy plugin source code vào đúng vị trí Kong expects
COPY kong-plugin-keycloak-introspect/kong/plugins/keycloak-introspect /usr/local/share/lua/5.1/kong/plugins/keycloak-introspect
COPY kong-plugin-keycloak-introspect/init.lua /usr/local/share/lua/5.1/kong/plugins/keycloak-introspect/init.lua

# Quay lại user kong
USER kong

# Khai báo plugin trong biến môi trường
ENV KONG_PLUGINS=bundled,keycloak-introspect
